Assignment 3
================
Carmen Chen
11/3/2021

**APIs**

1.  Using the NCBI API, look for papers that show up under the term
    “sars-cov-2 trial vaccine.” Look for the data in the pubmed
    database, and then retrieve the details of the paper as shown in
    lab 7. How many papers were you able to find?

``` r
#Download the website
website <- xml2::read_html("https://pubmed.ncbi.nlm.nih.gov/?term=sars-cov-2+trial+vaccine")

#Find the counts
counts <- xml2::xml_find_first(website, "/html/body/main/div[9]/div[2]/div[2]/div[1]/div[1]")

#Turn it into text
counts <- as.character(counts)

#Extract the data using regex
stringr::str_extract(counts, "[0-9,]+")
```

    ## [1] "2,329"

``` r
library(httr)

#Make query
query_ids <- GET(
  url = "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi",
  query = list(
    db = "pubmed",
    term = "sars-cov-2 trial vaccine",
    retmax = 1000
  )
)

#Extract the content of the response of GET
ids <- httr::content(query_ids)
```

``` r
#Turn the result into a character vector
ids <- as.character(ids)

#Find all the ids
ids <- stringr::str_extract_all(ids, "<Id>[[:digit:]]+</Id>")[[1]]

#Remove all the leading and trailing <Id> </Id>
ids <- stringr::str_remove_all(ids, "<Id>|</Id>")
head(ids)
```

    ## [1] "34729549" "34726743" "34715931" "34713912" "34711598" "34704204"

``` r
paste(ids, collapse =",")
```

    ## [1] "34729549,34726743,34715931,34713912,34711598,34704204,34703690,34702753,34698827,34697214,34697213,34696316,34696233,34696198,34691078,34691071,34690266,34689821,34689348,34689329,34688948,34688944,34674742,34671773,34671153,34670021,34667427,34666989,34665829,34664616,34659237,34656181,34655522,34649298,34642699,34642255,34635537,34635140,34633259,34632800,34625925,34624681,34624095,34620531,34620207,34615860,34607353,34601675,34601658,34597941,34597298,34594036,34588689,34587382,34585882,34582072,34580673,34580303,34580150,34579229,34578426,34578287,34576859,34565332,34561414,34558459,34557558,34555007,34555004,34551225,34551104,34547465,34545372,34545367,34541571,34539248,34537835,34536349,34535094,34534516,34526698,34526310,34526104,34526086,34525277,34525276,34522017,34521677,34519540,34519154,34516531,34515857,34508342,34499628,34496115,34494032,34494017,34493842,34490414,34488843,34480858,34480857,34480056,34475443,34472778,34464194,34456331,34455307,34452774,34451985,34451950,34451494,34449681,34447374,34446699,34446634,34445700,34445670,34444549,34441048,34438245,34437985,34417165,34416193,34414930,34414368,34413782,34411531,34401888,34400116,34396154,34393789,34388532,34388395,34379917,34379915,34378087,34375655,34374951,34373623,34373443,34370971,34365034,34364311,34362855,34362060,34359986,34358163,34358090,34349145,34348019,34347950,34344823,34343152,34336136,34335627,34331051,34330945,34330895,34325728,34324836,34323685,34316063,34316051,34313516,34310400,34308319,34303849,34297792,34290390,34289273,34285402,34277027,34273397,34273260,34272224,34270458,34270449,34267764,34267349,34267185,34260849,34260716,34258603,34254894,34251417,34250456,34249853,34249101,34246358,34244768,34244681,34244387,34243845,34242356,34241782,34238338,34236264,34234059,34230477,34225791,34225463,34224667,34222848,34213848,34212944,34212511,34209711,34206727,34202573,34202429,34200720,34197764,34197281,34192426,34190575,34189538,34181880,34180347,34179072,34178577,34174875,34174097,34171559,34170788,34166399,34162739,34162141,34158283,34158099,34136133,34154428,34153264,34153099,34150443,34146892,34145414,34145413,34143581,34132395,34130883,34124693,34119845,34119350,34118838,34117084,34116392,34112671,34112143,34108186,34107529,34105617,34104816,34101717,34100150,34097570,34097044,34093548,34089576,34088761,34086877,34086762,34085278,34084669,34081073,34080997,34080991,34080537,34078215,34075245,34066475,34062137,34060379,34059561,34057040,34056571,34053848,34052418,34051840,34051181,34049688,34046036,34044428,34043894,34043693,34041932,34040244,34037666,34036720,34035902,34035111,34033367,34028468,34025393,34024060,34019801,34012335,34007998,34007070,34006847,34006597,34001183,33999127,33998949,33998108,33997827,33993685,33991474,33989091,33984466,33980657,33979495,33976001,33974607,33958800,33956667,33953551,33951913,33951417,33951374,33951370,33948031,33946736,33945605,33945284,33942351,33941657,33935504,33932943,33930321,33930320,33929280,33928916,33928745,33923363,33920489,33910617,33909052,33908359,33908358,33908356,33908355,33908353,33908352,33908350,33907509,33907329,33907209,33903149,33901607,33900279,33897204,33896663,33895475,33895322,33888900,33887209,33887208,33887070,33886112,33882225,33882211,33880481,33875266,33873199,33870886,33866000,33861315,33861303,33861165,33857620,33857453,33849629,33846694,33844575,33843251,33841038,33834614,33833104,33831133,33826784,33824579,33822773,33822770,33822361,33821569,33818952,33815890,33815095,33813139,33812474,33807957,33807839,33807787,33802467,33798499,33797374,33795692,33793189,33789273,33780993,33780663,33778462,33778130,33773276,33773111,33772240,33770576,33768743,33767619,33767200,33760277,33758124,33757336,33755218,33754539,33753421,33749864,33748833,33748805,33746095,33745730,33744042,33743846,33743214,33733663,33731427,33730597,33730471,33728098,33727699,33725432,33723914,33723371,33721548,33720612,33719877,33718854,33711085,33707061,33705727,33704435,33704352,33693552,33693529,33692215,33691913,33688668,33688588,33688540,33688023,33686064,33685502,33683637,33683080,33682603,33681731,33676349,33676266,33669550,33666864,33662102,33660020,33658707,33658246,33655830,33655276,33652582,33652065,33651967,33648905,33643421,33640286,33640145,33640052,33639625,33639165,33637387,33635275,33635184,33634346,33632828,33627824,33627440,33627357,33627051,33626250,33623865,33623151,33619170,33618278,33617777,33617776,33616486,33612319,33608249,33606782,33605892,33602838,33596958,33596800,33596363,33596144,33595410,33594794,33592338,33591649,33591423,33590417,33585808,33582489,33582237,33579547,33578448,33578007,33577086,33576498,33574597,33571468,33569389,33562619,33559733,33558296,33550606,33550050,33550049,33549712,33548194,33547453,33547431,33545094,33545014,33544720,33544024,33542114,33539825,33539728,33538178,33535821,33535811,33535239,33531462,33526007,33524990,33524979,33524311,33516986,33516602,33514888,33514629,33512669,33512650,33512353,33511068,33510536,33510489,33508241,33508228,33508225,33501442,33497610,33494754,33493917,33487213,33485468,33485435,33482248,33482181,33476807,33476760,33472681,33469600,33469576,33469205,33464636,33460584,33460347,33447071,33445936,33444545,33443616,33442691,33442007,33440088,33435774,33430745,33429880,33427749,33422546,33421580,33421475,33420405,33419872,33414636,33408775,33403227,33402220,33400058,33398242,33396343,33392485,33390829,33390810,33390384,33389724,33382675,33380328,33378609,33377885,33371042,33370015,33367857,33364539,33363416,33362278,33361645,33356860,33355053,33349145,33343798,33340018,33336780,33335323,33335322,33334920,33334616,33334613,33334287,33326722,33323690,33322733,33320635,33320222,33316990,33315080,33315069,33308153,33306989,33306985,33306980,33305156,33304884,33302034,33301429,33301246,33300456,33296420,33296403,33295312,33294881,33290571,33290205,33289156,33288887,33282604,33279318,33279317,33273083,33270497,33270478,33268419,33267759,33264067,33257213,33253656,33252246,33251385,33247210,33245898,33240370,33236048,33234420,33232690,33230278,33227285,33226855,33224928,33221134,33220855,33218366,33218001,33217362,33216636,33215698,33215168,33214255,33211647,33211246,33210600,33200726,33200085,33199901,33196555,33189639,33188930,33188794,33185828,33185497,33178207,33177689,33175649,33171100,33168971,33167401,33166303,33165503,33161277,33160429,33160207,33156564,33154276,33082937,33137284,33134200,33133071,33132155,33125926,33125914,33120812,33119725,33119547,33115909,33115460,33113270,33110944,33106170,33104216,33101792,33100195,33096260,33093069,33093065,33090877,33087460,33087452,33087395,33085884,33083026,33082550,33082543,33082093,33077943,33077678,33074704,33072111,33070079,33069443,33069282,33069281,33067570,33067112,33065034,33059771,33057226,33053301,33053279,33051445,33043110,33042591,33041111,33038433,33034449,33034095,33033884,33033397,33033196,33032740,33031856,33030819,33030329,33022727,33022293,33013255,33012858,33012602,33012348,33009982,33009266,32998488,32998157,32997699,32997318,32994572,32991900,32991794,32991223,32989315,32989290,32988688,32985963,32983183,32979327,32978611,32974268,32973779,32971527,32969369,32967006,32966155,32963672,32958009,32957894,32948465,32943115,32935536,32935331,32934758,32934375,32933536,32929259,32926660,32920170,32918548,32918053,32915657,32908297,32908295,32907286,32905186,32905011,32903199,32901559,32900341,32898468,32896291,32896275,32896274,32888871,32887954,32886952,32877576,32867651,32862824,32862110,32857836,32857671,32854391,32851596,32850922,32850116,32846196,32846056,32845317,32841042,32839784,32839593,32839191,32839164,32838299,32838206,32837854,32837100,32837030,32829400,32821086,32820746,32813843,32808972,32802896,32800805,32792167,32789505,32789501,32789500,32787752,32785213,32784685,32782402,32782400,32778829,32778225,32770854,32769322,32767687,32762250,32758881,32756549,32756480,32746653,32742241,32742146,32739342,32737453,32734670,32731192,32726230,32725080,32723801,32719684,32719619,32718020,32710003,32702822,32702299,32702298,32699167,32696862,32694847,32694043,32692266,32688370,32671831,32669462,32667492,32664543,32663912,32662677,32661140,32661074,32658877,32658841,32653511,32653463,32653224,32650672,32648899,32646869,32645630,32636754,32632960,32628748,32624257,32620409,32615862,32592501,32591957,32584199,32577634,32574236,32571773,32565096,32563940,32562594,32561657,32557771,32548679,32544799,32540733,32535032,32529703,32527823,32525830,32520683,32516839,32515404,32511340,32511333,32507409,32505245,32503874,32503817,32503602,32499154,32498742,32498131,32496238,32495979,32495226,32494546,32493494,32493478,32474009,32466392,32460358,32459832,32459574,32456404,32453605,32452350,32450106,32444382,32442040,32441894,32437659,32437587,32434788,32425638,32423342,32420637,32417996,32414757,32410772,32410758,32407706,32407539,32406317,32406253,32404020,32393664,32393526,32387332,32387041,32387011,32381692,32380316,32378805,32376359,32366816,32365191,32359402"

2.  Using the list of pubmed ids you retrieved, download each papers’
    details using the query parameter rettype = abstract. If you get
    more than 250 ids, just keep the first 250.

``` r
publications <- GET(
  url   = "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi",
  query = list(
   db = "pubmed",
   id =  I(paste(ids, collapse = ",")),
   retmax = 250,
   rettype = "abstract"
    )
)

# Turning the output into character vector
publications <- httr::content(publications)
publications_txt <- as.character(publications)
```

3.  As we did in lab 7. Create a dataset containing the following:
    Pubmed ID number, Title of the paper, Name of the journal where it
    was published, Publication date, and Abstract of the paper (if any).

``` r
pub_char_list <- xml2::xml_children(publications)
pub_char_list <- sapply(pub_char_list, as.character)

abstracts <- str_extract(pub_char_list, "<Abstract>[[:print:][:space:]]+</Abstract>")
abstracts <- str_remove_all(abstracts, "</?[[:alnum:]- =\"]+>") # '</?[[:alnum:]- ="]+>'
abstracts <- str_replace_all(abstracts, "[[:space:]]+", " ")

titles <- str_extract(pub_char_list, "<ArticleTitle>[[:print:][:space:]]+</ArticleTitle>")
titles <- str_remove_all(titles, "</?[[:alnum:]- =\"]+>")

database <- data.frame(
  PubMed = ids,
  Title = titles,
  Abstract = abstracts
)
knitr::kable(database[1:20,], caption = "Papers about sars-cov-2 trial vaccine")
```

| PubMed   | Title | Abstract |
|:---------|:------|:---------|
| 34729549 | NA    | NA       |
| 34726743 | NA    | NA       |
| 34715931 | NA    | NA       |
| 34713912 | NA    | NA       |
| 34711598 | NA    | NA       |
| 34704204 | NA    | NA       |
| 34703690 | NA    | NA       |
| 34702753 | NA    | NA       |
| 34698827 | NA    | NA       |
| 34697214 | NA    | NA       |
| 34697213 | NA    | NA       |
| 34696316 | NA    | NA       |
| 34696233 | NA    | NA       |
| 34696198 | NA    | NA       |
| 34691078 | NA    | NA       |
| 34691071 | NA    | NA       |
| 34690266 | NA    | NA       |
| 34689821 | NA    | NA       |
| 34689348 | NA    | NA       |
| 34689329 | NA    | NA       |

Papers about sars-cov-2 trial vaccine
